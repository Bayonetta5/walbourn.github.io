---
layout: post
title: DDSWithoutD3DX Sample Update
date: 2010-07-15 14:50
author: walbourn
comments: true
categories: [dds, Uncategorized]
---
<p>Over the past few releases of the DirectX SDK, I've been working on updating our documentation for the DDS file format. The <strong>DDSWithoutD3DX</strong> and <strong>DDSWithoutD3DX11</strong> samples in the <em>DirectX SDK (June 2010)</em> release demonstrate the details of interpreting the DDS file format for basic 2D textures&nbsp;and 2D texture arrays for Direct3D 9, Direct3D 10.x, and Direct3D 11. Since the June release, I've been expanding the sample to support cubemaps, volume textures, and 1D textures. In the process I also found a number of minor issues with the DDSTextureLoader code and the DDS.H header.</p>
<p>Attached to this post is a ZIP containing an updated DDS.H, DDSTextureLoader.cpp, and DDSTextureLoader.h which you can drop into the <strong>DDSWithoutD3DX11</strong> sample code in the DirectX SDK (June 2010). Note that the <strong>DDSWithoutD3DX</strong> sample is very similiar if you are looking to use it with Direct3D 10.x instead of Direct3D 11, although there are some additional complexities when dealing with cubemap arrays which are supported by the Direct3D 10.1 API with D3D10_FEATURE_LEVEL_10_1 hardware, but not the Direct3D 10.0 API or D3D10_FEATURE_LEVEL_10_0 hardware.</p>
<p><strong>Update</strong>: A recent inquiry about the DDS file format has brought up an area of common confusion when parsing these files w.r.t. to the pitch&nbsp;alignment of uncompressed pixel data (there are different rules for computing the sizes of block compressed DXT/BC formats and&nbsp;the packed R8G8_B8G8/G8R8_G8B8 pixel formats). The DDS file format always uses <span style="text-decoration: underline;">byte</span> alignment for the pitch of uncompressed data, but the original <em>DrawDraw</em> structures used to define the format document that the pitch should be <span style="text-decoration: underline;">DWORD</span> aligned. With many common texture formats and sizes, these computations yield the same results but for 16-bit and 24-bit per pixel formats, these results do not agree.&nbsp; This is further complicated by the fact that many DDS writers (including D3DX) do not set a PITCH value in the header, so DDS readers have to compute one from assumptions. The recommendation is to use byte-alignment (which is what the <strong>DDSWithoutD3DX</strong> samples do), but you may want to support a legacy compatabilty flag on your DDS reader that will compute DWORD aligned pitch values should you encounter content that uses the incorrect "DWORD" alignment. You can also side-step this issue by prefering the use of&nbsp;block compressed (DXT/BC) or 32-bit per pixel formats--16-bit and 24-bit per pixel formats are not supported by Direct3D 10.x or 11 in any case. It is also important than when copying the data from the DDS structure into a Direct3D resource that you do not assume the pitch values will match, so you must support copying line-by-line (or use initData for Direct3D 10.x &amp; 11 which is what the <strong>DDSWithoutD3DX</strong> sample demonstrates).</p>
<p><strong>Update 2:</strong> I found a minor problem with legacy cubemap DDS files. I was over-validating legacy volume map DDS files for having the 'right' flags set in dwCaps2, which are often missing.</p>
<p><strong>Update 3:</strong> Minor issue, but BC4 formats should be 4 BitsPerPixel. Doesn't affect the functionality because GetSurfaceInfo has special handling for BC4 formats already, but in the interest of avoiding future cut &amp; paste issues I've fixed it in another refresh of the source.</p>
<p>See also <a title="Games for Windows and the DirectX SDK" href="http://blogs.msdn.com/b/chuckw/archive/2010/02/05/the-dds-file-format-lives.aspx">The DDS File Format Lives</a> and <a title="DirectX SDK and Games for Windows" href="http://blogs.msdn.com/b/chuckw/archive/2010/06/15/dds-update-and-10-10-10-2-problems.aspx">DDS Update and 10:10:10:2 problems</a></p>
<p><strong>Update 4: </strong>For Direct3D 11 only applications, consider using the DDSTextureLoader included in <a href="http://go.microsoft.com/fwlink/?LinkId=248929">DirectXTK</a> instead.</p>
<p><a href="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Components.PostAttachments/00/10/03/88/57/DDSTextureLoader%20Updates%20August%202011.zip" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-components-postattachments/00-10-03-88-57/DDSTextureLoader-Updates-August-2011.zip">DDSTextureLoader Updates August 2011.zip</a></p>
